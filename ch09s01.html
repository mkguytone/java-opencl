<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.1. コマンドキュー</title><link rel="stylesheet" type="text/css" href="index.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Java-OpenCL入門" /><link rel="up" href="ch09.html" title="第9章 OpenCLランタイム" /><link rel="prev" href="ch09.html" title="第9章 OpenCLランタイム" /><link rel="next" href="ch09s02.html" title="9.2. バッファオブジェクト" /><meta xmlns="" name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0" /><script xmlns="" type="text/javascript" src="prettify/prettify.js"></script><link xmlns="" rel="stylesheet" type="text/css" href="prettify/skins/sons-of-obsidian.css" /><script xmlns="">
    window.addEventListener("load", function() {
      PR.prettyPrint();
	  });	
	</script><script xmlns="" type="text/javascript" src="script/head.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch09.html">戻る</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch09s02.html">次へ</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_コマンドキュー"></a>9.1. コマンドキュー</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_clcreatecommandqueue"></a>9.1.1. clCreateCommandQueue</h3></div></div></div><p>clCreateCommandQueue関数はコマンドキューを生成。</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">注記</h3><p>詳しくは「表：clCreateCommandQueue」（<a class="xref" href="apbs11.html#clCreateCommandQueue" title="表B.23 表：clCreateCommandQueue">表B.23「表：clCreateCommandQueue」</a>）と「表：cl_command_queue_properties」（<a class="xref" href="apbs11.html#cl_command_queue_properties" title="表B.24 表：cl_command_queue_properties">表B.24「表：cl_command_queue_properties」</a>）を参照ください。</p></div><pre xmlns="" class="prettyprint">cl_command_queue org.jocl.CL.clCreateCommandQueue(
    cl_context context, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO25-1"></a>(1)
    cl_device_id device, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO25-2"></a>(2)
    long properties, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO25-3"></a>(3)
    int[] errcode_ret) //<a xmlns="http://www.w3.org/1999/xhtml" id="CO25-4"></a>(4)</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-1">(1)</a> </p></td><td valign="top" align="left"><p>
有効なOpenCLコンテキストを指定。
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-2">(2)</a> </p></td><td valign="top" align="left"><p>
対象とするOpenCLデバイスを指定。
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-3">(3)</a> </p></td><td valign="top" align="left"><p>
コマンドキューのプロパティのリストを指定するビットフィールド。
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-4">(4)</a> </p></td><td valign="top" align="left"><p>
適切なエラーコードを戻します。
</p></td></tr></table></div><p>では実際のコードを見てみましょう。以下が例となります。</p><pre xmlns="" class="prettyprint">cl_command_queue queue;
queue = clCreateCommandQueue(
    context,
    device,
    CL_QUEUE_PROFILING_ENABLE, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO26-1"></a>(1)
    null);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-1">(1)</a> </p></td><td valign="top" align="left"><p>
プロファイルを有効にします。
</p></td></tr></table></div><p>プロパティを入れない場合は、0と入力すれば、フィールドは無視されます。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_cl_command_queue_properties"></a>9.1.2. cl_command_queue_properties</h3></div></div></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">注記</h3><p>詳しくは「表：clCreateCommandQueue」（<a class="xref" href="apbs11.html#clCreateCommandQueue" title="表B.23 表：clCreateCommandQueue">表B.23「表：clCreateCommandQueue」</a>）と「表：cl_command_queue_properties」（<a class="xref" href="apbs11.html#cl_command_queue_properties" title="表B.24 表：cl_command_queue_properties">表B.24「表：cl_command_queue_properties」</a>）を参照ください。</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_clretaincommandqueue"></a>9.1.3. clRetainCommandQueue</h3></div></div></div><p>clRetainCommandQueue関数はcommand_queueの参照カウントをインクリメント。</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">注記</h3><p>詳しくは「表：clRetainCommandQueue」（<a class="xref" href="apbs11.html#clRetainCommandQueue" title="表B.25 表：clRetainCommandQueue">表B.25「表：clRetainCommandQueue」</a>）を参照ください。</p></div><pre xmlns="" class="prettyprint">cl_int clRetainCommandQueue (
    cl_command_queue command_queue //<a xmlns="http://www.w3.org/1999/xhtml" id="CO27-1"></a>(1)
)</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-1">(1)</a> </p></td><td valign="top" align="left"><p>
コマンドキューを指定。
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_clreleasecommandqueue"></a>9.1.4. clReleaseCommandQueue</h3></div></div></div><p>clReleaseCommandQueue関数はコマンドキューの参照カウントをデクリメントします。</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">注記</h3><p>詳しくは「表：clReleaseCommandQueue」（<a class="xref" href="apbs11.html#clReleaseCommandQueue" title="表B.26 表：clReleaseCommandQueue">表B.26「表：clReleaseCommandQueue」</a>）を参照ください。</p></div><pre xmlns="" class="prettyprint">cl_int clReleaseCommandQueue (
    cl_command_queue command_queue //<a xmlns="http://www.w3.org/1999/xhtml" id="CO28-1"></a>(1)
)</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-1">(1)</a> </p></td><td valign="top" align="left"><p>
コマンドキューを指定。
</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_clgetcommandqueueinfo"></a>clGetCommandQueueInfo</h4></div></div></div><p>clGetCommandQueueInfo関数はコマンドキューについての情報を取得します。</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">注記</h3><p>詳しくは「表：clGetCommandQueueInfo」（<a class="xref" href="apbs11.html#clGetCommandQueueInfo" title="表B.27 表：clGetCommandQueueInfo">表B.27「表：clGetCommandQueueInfo」</a>）と「表：cl_command_queue_info」（<a class="xref" href="apbs11.html#cl_command_queue_info" title="表B.28 表：cl_command_queue_info">表B.28「表：cl_command_queue_info」</a>）を参照ください。</p></div><pre xmlns="" class="prettyprint">cl_int clGetCommandQueueInfo (
    cl_command_queue command_queue, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO29-1"></a>(1)
    cl_command_queue_info param_name, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO29-2"></a>(2)
    size_t param_value_size, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO29-3"></a>(3)
    void *param_value, //<a xmlns="http://www.w3.org/1999/xhtml" id="CO29-4"></a>(4)
    size_t *param_value_size_ret //<a xmlns="http://www.w3.org/1999/xhtml" id="CO29-5"></a>(5)
)</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-1">(1)</a> </p></td><td valign="top" align="left"><p>
情報を取得するコマンドキューを指定。
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-2">(2)</a> </p></td><td valign="top" align="left"><p>
取得する情報を指定。
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-3">(3)</a> </p></td><td valign="top" align="left"><p>
param_nameで指定した情報についての値が戻るメモリ空間へのポインタ。
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-4">(4)</a> </p></td><td valign="top" align="left"><p>
param_valueが指すメモリの（バイトで表す）サイズを指定。
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-5">(5)</a> </p></td><td valign="top" align="left"><p>
param_valueが取得するデータの実際の（バイトで表す）サイズを戻す。
</p></td></tr></table></div><p>ではコード例を見てみましょう。以下のコードでは、コマンドキューに関連付けられたデバイスを取得しています。</p><pre xmlns="" class="prettyprint">err = clGetCommandQueueInfo(
    queue,
    CL_QUEUE_DEVICE,
    sizeof(cl_device_id),
    &amp;dev,
    NULL);
if(err &lt; 0) {
    perror("Failed to get a command queue information on queue1");
    exit(1);
};</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_実装例_2"></a>実装例</h4></div></div></div><pre xmlns="" class="prettyprint">#ifndef HELLO_H
#define HELLO_H

#include &lt;math.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;

#ifdef __APPLE__
#include &lt;OpenCL/cl.h&gt;
#else
#include &lt;CL/cl.h&gt;
#endif

#define PROGRAM_FILE "kernel_helloworld.cl"
#define FUNC "helloworld"

int main(int argc, char **argv)
{
        int err;

    /* OpenCL APIの変数 */
        cl_device_id device;
        cl_context context;
        cl_command_queue queue1;
        cl_command_queue queue2;
        cl_platform_id platform;

        /*
         * OpenCLデバイスのプラットフォームの特定
         * 最初に見つけたプラットフォームを使用します。
         * */
        err = clGetPlatformIDs(1, &amp;platform, NULL);
        if(err &lt; 0) {
          perror("Failed to identify a platform");
          exit(1);
        }

        /*
         * CPU/GPUデバイスの情報取得をします。
         * */
        err = clGetDeviceIDs(platform, CL_DEVICE_TYPE_GPU, 1, &amp;device, NULL);
        if(err == CL_DEVICE_NOT_FOUND) {
          err = clGetDeviceIDs(platform, CL_DEVICE_TYPE_CPU, 1, &amp;device, NULL);
        }
        if(err &lt; 0) {
          perror("Failed to access the devices on the platform");
          exit(1);
        }

        /* コンテキストの生成をします。 */
        context = clCreateContext(NULL, 1, &amp;device, NULL, NULL, &amp;err);
        if(err &lt; 0) {
          perror("Unable to create a context");
          exit(1);
        }

        /* コマンドキューを生成します */
        queue1 = clCreateCommandQueue(context,
                        device,
                        0,
                        &amp;err);
        if(err &lt; 0) {
          perror("Failed to create a command queue 1");
          exit(1);
        };

        queue2 = clCreateCommandQueue(context,
                        device,
                        CL_QUEUE_PROFILING_ENABLE,
                        &amp;err);
        if(err &lt; 0) {
          perror("Failed to create a command queue 2");
          exit(1);
        };

        cl_device_id dev;
        cl_command_queue_properties cpro;

        err = clGetCommandQueueInfo(queue1, CL_QUEUE_DEVICE, sizeof(cl_device_id), &amp;dev, NULL);
        if(err &lt; 0) {
          perror("Failed to get a command queue information on queue1");
          exit(1);
        };
        err |= clGetCommandQueueInfo(queue2, CL_QUEUE_PROPERTIES, sizeof(cl_command_queue_properties), &amp;cpro, NULL);
        if(err &lt; 0) {
          perror("Failed to get a command queue information on queue2");
          exit(1);
        };

        size_t size = 0;
        err = clGetDeviceInfo(dev, CL_DEVICE_MAX_WORK_GROUP_SIZE, sizeof(size), &amp;size, NULL);
        if(err &lt; 0) {
                printf("errorcode: %d\n",err);
                perror("Failed to get a device information");
                exit(1);
        };
        printf("CL_DEVICE_MAX_WORK_GROUP_SIZE: %lu\n", size);

        if(cpro &amp; CL_QUEUE_PROFILING_ENABLE) {
                printf("CL_QUEUE_PROFILING_ENABLE: on\n");
        }
        if(cpro &amp; CL_QUEUE_OUT_OF_ORDER_EXEC_MODE_ENABLE) {
                printf("CL_QUEUE_OUT_OF_ORDER_EXEC_MODE_ENABLE: on\n");
        }

        /* OpenCL APIで割り当てたメモリーを解放します */
    clReleaseCommandQueue(queue1);
    clReleaseCommandQueue(queue2);
    clReleaseContext(context);

}

#endif //HELLO_H</pre><p><strong>出力. </strong>
</p><pre xmlns="" class="prettyprint">CL_DEVICE_MAX_WORK_GROUP_SIZE: 512
CL_QUEUE_PROFILING_ENABLE: on</pre><p>
</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_cl_command_queue_info"></a>9.1.5. cl_command_queue_info</h3></div></div></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">注記</h3><p>詳しくは「表：clGetCommandQueueInfo」（<a class="xref" href="apbs11.html#clGetCommandQueueInfo" title="表B.27 表：clGetCommandQueueInfo">表B.27「表：clGetCommandQueueInfo」</a>）と「表：cl_command_queue_info」（<a class="xref" href="apbs11.html#cl_command_queue_info" title="表B.28 表：cl_command_queue_info">表B.28「表：cl_command_queue_info」</a>）を参照ください。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09.html">戻る</a> </td><td width="20%" align="center"><a accesskey="u" href="ch09.html">上に戻る</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09s02.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div><wrapper xmlns=""><p>Copyright 2018-2019, by Masaki Komatsu</p>


</wrapper></body></html>